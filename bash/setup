#!/usr/bin/env bash
set -euo pipefail

BACKUP_DIR=$HOME/bash_backup
BACKUP_SUFFIX=".backup.$(date +%Y%m%d%H%M%S)"

mkdir -p $BACKUP_DIR

backup_if_exists() {
    local target="$1"
    local full_target="${HOME}/${target}"
    if [ -e "$full_target" ] && [ ! -L "$full_target" ]; then
        local target_path="${BACKUP_DIR}/${target}${BACKUP_SUFFIX}"
        mv "$full_target" "$target_path"
        echo "Backed up $full_target -> ${target_path}"
    fi
}

# Files you want to manage
for f in .bashrc .bash_profile .profile .bash_aliases .bash_exports .bash_functions; do
    backup_if_exists "$f"
    rm -f "$HOME/$f"
done

ln -sfn "$PWD/.bashrc" "$HOME/.bashrc"
ln -sfn "$PWD/.profile" "$HOME/.profile"
